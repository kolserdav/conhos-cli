# Файл конфигурации проекта

Файл конфигурации проекта это обязательный файл, который служит для настройки сервисов проекта, он должен быть разположен в корне проекта и его содержание должно соответствовать строгим правилам, которые описаны далее.

> Для автоматического создания базового файла конфигурации вы можете обратиться к [Инициализация проекта](./GettingStarted.md#инициализация_проекта)

## Пример файла конфигурации

```yml
name: name-of-project # Название проекта
services:
  node1:
    type: node # Среда исполнения Node.js
    size: mili # Размер сервиса (влияет на цену)
    active: true # Сервис запущен
    version: latest # Версия контейнера
    pwd: examples/postgres # Путь до рабочей папки (файлы и папки из этого пути будут загружены в облако)
    exclude: # Файлы и папки исключения (путь относительно корня "pwd")
      - tmp
      - node_modules
    command: npm i && npm run start # Команда при старте контейнера
    ports: # Список внешних портов
      - port: 3000
        type: http
    environment: # Переменные окружения
      - PORT=3000
```

## Поля файла конфигурации верхнего уровня

### Название проекта:

Идентификатор проекта в облаке

```yml
name: my-awesome-project
```

**Вам строго необходимо следить за уникальностью этого поля между разными проектами, иначе один ваш проект перезапишет другой проект в облаке.**

### Сервисы:

Перечень сервисов которые необходимы для работы приложения проекта

```yml
services:
  # Уникальное имя сервиса
  node0:
    # ... Поля конфигурации сервиса
```

Подробнее о сервисах смотрите в [Поля конфигурации сервиса](./ConfigFile.md#поля_конфигурации_сервиса)

## Поля конфигурации сервиса

Поле верхнего уровня **services** должно иметь корневое поле с произвольным уникальным названием и вложенный перечень обязательных и опциональных полей.

### Тип сервиса

От этого зависит образ операционной системы и перечень установленных зависимостей сервиса

```yml
type: node
```

Поддерживаемые типы сервисов: _'node' | 'rust' | 'golang' | 'python' | 'redis' | 'postgres' | 'mysql' | 'adminer'_

### Размер сервиса

От этого зависит выделение ресуров облачного сервера для работы конкретного сервиса

```yml
size: mili
```

Поддерживаемые типы размеров: _'pico' | 'nano' | 'micro' | 'mili' | 'santi' | 'deci' | 'deca' | 'hecto' | 'kilo' | 'mega'_

### Активный сервис

Чтобы сервис был добавлен или обновлен необходимо указать **true**. Если указано **false** то сервис будет удален из облака

```yml
active: true
```

### Версия сервиса

Версия сервиса взятая с оффициального DockerHub репозитория. Например для Node.js будет валидной один из поддерживаемых в нстоящее время тегов https://hub.docker.com/_/node

```yml
version: latest
```

### Стартовая команда

Команда выполняемая при старте сервиса. Должна содержать команды установки и сборки перед запуском программы если это необходимо.

```yml
command: npm i && npm run start
```

### Порты

Порты, которые должны быть проброшены для публичных сервисов наружу, для каждого порта будет использоваться отдельный адрес в сети на 80 и 443 порту.
> `public` указывает должен ли порт быть открытым для интернета по доменному имени или он будет доступен только через [Внутренние ссылки](./ConfigFile.md#внутренние_ссылки) для других сервисов проекта.
```yml
ports:
  - port: 3000
    type: http
    # Оптионально
    location: /path-url # По умолчанию "/"
    # Оптионально
    proxy_path: / # По умолчанию ""
    # Оптионально
    timeout: 30s
    # Оптионально
    buffer_size: 64k
    # Оптионально
    static:
      - location: /static
        path: static
        # Опционально
        index: index.html
```

Поддерживаемые типы портов: _'http' | 'ws' | 'chunked' | 'php'_

### Переменные среды

Массив переменных среды, которые будут доступны процессам внутри сервиса

> Поддерживается использование переменных среды вашего устройства в любом месте файла, например: `$PORT` или `${PORT}`

```yml
environment:
  - PORT=3000
```

### Внутренние ссылки

Массив имен сервисов на которые данный сервис будет иметь выход по внутренним ссылкам.

```yml
depends_on:
  - postgres0
```

> Когда в качестве внутренней ссылки указан один из подключаемых сервисов например **postgres** то переменная среды с адресом этой ссылки будет автоматически добавлена сервису в процессе работы команды **deploy**

### Рабочая папка

Данная директория будет загружена в облако и станет рабочей директорией сервиса

```yml
pwd: ./
```

### Исключения

Перечень дочерних файлов или папок, которые не должны загружаться в облако

```yml
# Опционально
exclude:
  - node_modules
  - dist
  - some/nested
```

## Использование своего домена

После каждого запуска программа обновляет конфигурационный файл дописывая каждому сервису поле `domains`:

```yml
domains:
  '3000': unsoldered.cloud.conhos.ru
```

_Где `3000` это внешний порт, а `unsoldered.cloud.conhos.ru` это домен который сгенерирован автоматически._

### Установить свой домен

Для установки своего домена просто поменяйте это значение, на то которое нужно вам:

```yml
domains:
  '3000': example.ru
```

> Чтобы собственный домен заработал, обязательно убедитесь, что в хостинговой зоне этого домена добавлена `A` запись с IP узла на котором расположен ваш проект.
> Для получения IP узла проекта введите команду:

```sh
conhos ip
```

Чтобы изменения вступили в силу, после смены домена введите команду:

```sh
conhos deploy
```
